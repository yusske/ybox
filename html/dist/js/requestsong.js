/*! ybox 2015-03-04 */
!function(a){{var b=Backbone.Model.extend({defaults:{id:"0",songName:"empty",creationDate:"",comparator:0,counter:1,status:"new",clientid:""}}),c=Backbone.Collection.extend({model:b,url:function(){return"http://"+window.location.host+"/ybox/service/getplaylist.php?cid="+a("#cid").val()},parse:function(a){return a.output}}),d=Backbone.View.extend({tagName:"li",events:{"click span.swap":"swap","click span.delete":"remove"},initialize:function(){_.bindAll(this,"render","unrender","remove"),this.model.bind("change",this.render),this.model.bind("remove",this.unrender)},render:function(){return"played"===this.model.get("status")?(a(this.el).html("<a href='#'>"+this.model.get("songName")+"</a>"),a(this.el).attr("data-theme","b"),a(this.el).attr("data-icon","check")):a(this.el).html(this.model.get("songName")),this},unrender:function(){a(this.el).remove()},remove:function(){this.model.destroy()}}),e=Backbone.View.extend({el:a("body"),events:{"click button#add":"addItem"},initialize:function(){_.bindAll(this,"render","addItem","appendItem");var a=this;this.getSongs(),setInterval(function(){a.getSongs()},15e3)},getSongs:function(){var a=new c;a.comparator=function(a){return a.get("id")};var b=this;a.fetch({success:function(a,c){console.log(c),b.collection=a,b.collection.bind("add",this.appendItem),b.counter=0,b.render()},error:function(a){console.log(a)}})},render:function(){a("ol").empty();var b=this;_(this.collection.models).each(function(a){b.appendItem(a)},this)},addItem:function(){var c=a("#title").val(),d=a("#cid").val();if(""==a.trim(c))return!1;this.counter++;var e=new b;e.set({songName:c,clientid:d});var f=this;a.ajax({type:"POST",url:"http://"+window.location.host+"/ybox/service/createplaylist.php",data:{sn:c,cid:d}}).done(function(){f.appendItem(e)}),a("#title").val("")},appendItem:function(b){var c=new d({model:b});a("ol",this.el).append(c.render().el),a("ol").listview("refresh"),window.scrollTo(0,document.body.scrollHeight)}});new e}}(jQuery);